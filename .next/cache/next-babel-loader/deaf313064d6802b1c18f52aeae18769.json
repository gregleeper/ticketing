{"ast":null,"code":"import _regeneratorRuntime from \"/Users/gregleeper/jds/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/gregleeper/jds/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/gregleeper/jds/pages/tickets/index.js\",\n    _s2 = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport Layout from \"../../components/layout\";\nimport { useMemo, useEffect, useState } from \"react\";\nimport { API } from \"aws-amplify\";\nimport { ticketsByDate } from \"../../src/graphql/customQueries\";\nimport { listContracts } from \"../../src/graphql/queries.ts\";\nimport Link from \"next/link\";\nimport Table from \"../../components/table\";\nimport moment from \"moment\";\nimport { useQueryCache, useInfiniteQuery, useQuery, queryCache } from \"react-query\";\nimport { ReactQueryDevtools } from \"react-query-devtools\";\n\nvar AllTickets = function AllTickets() {\n  _s2();\n\n  var cache = useQueryCache();\n\n  var _useState = useState([]),\n      tickets = _useState[0],\n      setTickets = _useState[1];\n\n  var _useState2 = useState(),\n      contractFilter = _useState2[0],\n      setContractFilter = _useState2[1];\n\n  var _useState3 = useState([]),\n      contracts = _useState3[0],\n      setContracts = _useState3[1];\n\n  var _useState4 = useState(true),\n      isInitialLoad = _useState4[0],\n      setIsInitialLoad = _useState4[1];\n\n  var _useQuery = useQuery(\"contracts\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var _yield$API$graphql, myContracts;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return API.graphql({\n              query: listContracts,\n              variables: {\n                limit: 2000\n              }\n            });\n\n          case 2:\n            _yield$API$graphql = _context.sent;\n            myContracts = _yield$API$graphql.data.listContracts;\n            return _context.abrupt(\"return\", myContracts);\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }))),\n      contractsData = _useQuery.data;\n\n  var _useQuery2 = useQuery(\"tickets\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n    var _yield$API$graphql2, myTickets;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return API.graphql({\n              query: ticketsByDate,\n              variables: {\n                type: \"Ticket\",\n                sortDirection: \"DESC\",\n                limit: 500\n              }\n            });\n\n          case 2:\n            _yield$API$graphql2 = _context2.sent;\n            myTickets = _yield$API$graphql2.data.ticketsByDate.items;\n            return _context2.abrupt(\"return\", myTickets);\n\n          case 5:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  })), {\n    cacheTime: 1000 * 60 * 5,\n    refetchOnReconnect: true\n  }),\n      data = _useQuery2.data,\n      isFetched = _useQuery2.isFetched,\n      isSuccess = _useQuery2.isSuccess,\n      refetch = _useQuery2.refetch;\n\n  useEffect(function () {\n    if (data && isFetched) {\n      setTickets(data);\n    }\n  }, [data]);\n  useEffect(function () {\n    if (contractsData) {\n      var options = [];\n      contractsData.items.map(function (c) {\n        options.push({\n          value: c.id,\n          label: \"\".concat(c.contractNumber, \" - \").concat(c.contractTo.companyReportName, \" - \").concat(c.contractType)\n        });\n      });\n      setContracts(options);\n    }\n  }, [contractsData]);\n  var columns = useMemo(function () {\n    var _s = $RefreshSig$();\n\n    return [{\n      Header: \"Edit\",\n      accessor: \"id\",\n      disableFilters: true,\n      Cell: function Cell(_ref3) {\n        var value = _ref3.value;\n        return __jsx(Link, {\n          href: \"/tickets/edit/[id]\",\n          as: \"/tickets/edit/\".concat(value),\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 85,\n            columnNumber: 11\n          }\n        }, __jsx(\"a\", {\n          className: \"text-blue-800 underline hover:text-blue-800 hover:no-underline pl-2\",\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 13\n          }\n        }, \" \", \"Edit\"));\n      }\n    }, {\n      Header: \"Ticket #\",\n      accessor: \"ticketNumber\"\n    }, {\n      Header: \"Contract #\",\n      accessor: \"contract.contractNumber\",\n      Cell: function Cell(_ref4) {\n        var row = _ref4.row,\n            value = _ref4.value;\n        return __jsx(Link, {\n          href: \"/contracts/view/[id]\",\n          as: \"/contracts/view/\".concat(row.original.contractId),\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 11\n          }\n        }, __jsx(\"a\", {\n          className: \"text-blue-800 underline hover:text-blue-600 hover:no-underline \",\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 105,\n            columnNumber: 13\n          }\n        }, value));\n      }\n    }, {\n      Header: \"Company Name\",\n      accessor: \"contract.contractTo.companyReportName\"\n    }, {\n      Header: \"Ticket Date\",\n      accessor: \"ticketDate\",\n      Cell: function Cell(_ref5) {\n        var value = _ref5.value;\n        return __jsx(\"span\", {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 30\n          }\n        }, moment(value).format(\"MM/DD/YY\"));\n      }\n    }, {\n      Header: \"Corresponding Contract\",\n      accessor: \"corresondingContract.contractNumber\",\n      Cell: function Cell(_ref6) {\n        var row = _ref6.row,\n            value = _ref6.value;\n        return __jsx(Link, {\n          href: \"/contracts/view/[id]\",\n          as: \"/contracts/view/\".concat(row.original.correspondingContractId),\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 11\n          }\n        }, __jsx(\"a\", {\n          className: \"text-blue-800 underline hover:text-blue-600 hover:no-underline \",\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 13\n          }\n        }, value));\n      }\n    }, {\n      Header: \"Driver\",\n      accessor: \"driver\",\n      disableFilters: true\n    }, {\n      Header: \"Field #\",\n      accessor: \"fieldNum\",\n      disableFilters: true\n    }, {\n      Header: \"BaleCt\",\n      accessor: \"baleCount\",\n      disableFilters: true\n    }, {\n      Header: \"Gross W\",\n      accessor: \"grossWeight\",\n      disableFilters: true\n    }, {\n      Header: \"Tare W\",\n      accessor: \"tareWeight\",\n      disableFilters: true\n    }, {\n      Header: \"Net W\",\n      accessor: \"netWeight\",\n      disableFilters: true\n    }, {\n      Header: \"Net Tons\",\n      accessor: \"netTons\",\n      disableFilters: true,\n      Footer: _s(function Footer(_ref7) {\n        _s();\n\n        var rows = _ref7.rows;\n        var total = useMemo(function () {\n          return rows.reduce(function (sum, row) {\n            return row.values.netTons + sum;\n          }, 0);\n        }, [rows]);\n        return __jsx(\"div\", {\n          className: \"py-2 text-center flex justify-around items-center border-t-4 border-gray-900\",\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 13\n          }\n        }, __jsx(\"div\", {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 175,\n            columnNumber: 15\n          }\n        }, __jsx(\"span\", {\n          className: \"text-gray-600\",\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 17\n          }\n        }, \"Total:\"), \" \"), __jsx(\"div\", {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 15\n          }\n        }, __jsx(\"span\", {\n          className: \"text-lg font-bold\",\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 17\n          }\n        }, total.toFixed(2))));\n      }, \"TUahRIVHrNmruf3w2Blr6WVpjUQ=\")\n    }, {\n      Header: \"Paid\",\n      accessor: \"paymentId\",\n      Cell: function Cell(_ref8) {\n        var row = _ref8.row,\n            value = _ref8.value;\n        return value ? __jsx(Link, {\n          href: \"/payments/edit/[id]\",\n          as: \"/payments/edit/\".concat(row.original.paymentId),\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 13\n          }\n        }, __jsx(\"a\", {\n          className: \"text-blue-800 underline hover:text-blue-600 hover:no-underline \",\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 194,\n            columnNumber: 15\n          }\n        }, \"View\")) : null;\n      }\n    }];\n  }, []);\n  return __jsx(Layout, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: \"px-6\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"text-center w-1/2 mx-auto py-6 text-2xl font-bold\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 9\n    }\n  }, __jsx(\"h3\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 11\n    }\n  }, \"Tickets\")), __jsx(\"div\", {\n    className: \"\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"my-6 flex justify-between items-center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 13\n    }\n  }, __jsx(Link, {\n    href: \"/tickets/create\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 15\n    }\n  }, __jsx(\"a\", {\n    className: \"px-3 py-2 border border-gray-800 shadow hover:bg-gray-800 hover:text-white\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 17\n    }\n  }, \"Create New\"))), __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 13\n    }\n  }, __jsx(Link, {\n    href: \"/tickets/all\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 15\n    }\n  }, __jsx(\"a\", {\n    className: \"px-3 py-2 border border-gray-800 shadow hover:bg-gray-800 hover:text-white\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 17\n    }\n  }, \"Get All Tickets\"))))), __jsx(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 9\n    }\n  }, isFetched ? __jsx(Table, {\n    data: tickets,\n    columns: columns,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 13\n    }\n  }) : __jsx(\"p\", {\n    className: \"text-2xl text-gray-900\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 13\n    }\n  }, \"Loading... This could take a couple minutes while all the tickets are fetched.\"))), __jsx(ReactQueryDevtools, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 7\n    }\n  }));\n};\n\n_s2(AllTickets, \"IR+LQ6c4PqjWOsUR/LfuNRJJHH0=\", false, function () {\n  return [useQueryCache, useQuery, useQuery];\n});\n\n_c = AllTickets;\nexport var __N_SSP = true;\nexport default AllTickets;\n\nvar _c;\n\n$RefreshReg$(_c, \"AllTickets\");","map":{"version":3,"sources":["/Users/gregleeper/jds/pages/tickets/index.js"],"names":["Layout","useMemo","useEffect","useState","API","ticketsByDate","listContracts","Link","Table","moment","useQueryCache","useInfiniteQuery","useQuery","queryCache","ReactQueryDevtools","AllTickets","cache","tickets","setTickets","contractFilter","setContractFilter","contracts","setContracts","isInitialLoad","setIsInitialLoad","graphql","query","variables","limit","myContracts","data","contractsData","type","sortDirection","myTickets","items","cacheTime","refetchOnReconnect","isFetched","isSuccess","refetch","options","map","c","push","value","id","label","contractNumber","contractTo","companyReportName","contractType","columns","Header","accessor","disableFilters","Cell","row","original","contractId","format","correspondingContractId","Footer","rows","total","reduce","sum","values","netTons","toFixed","paymentId"],"mappings":"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","sourcesContent":["import Layout from \"../../components/layout\";\nimport { useMemo, useEffect, useState } from \"react\";\nimport { API, withSSRContext } from \"aws-amplify\";\nimport { ticketsByDate } from \"../../src/graphql/customQueries\";\nimport { listContracts } from \"../../src/graphql/queries.ts\";\nimport Link from \"next/link\";\nimport Table from \"../../components/table\";\nimport moment from \"moment\";\nimport {\n  useQueryCache,\n  useInfiniteQuery,\n  useQuery,\n  queryCache,\n} from \"react-query\";\nimport { ReactQueryDevtools } from \"react-query-devtools\";\n\nconst AllTickets = () => {\n  const cache = useQueryCache();\n  const [tickets, setTickets] = useState([]);\n  const [contractFilter, setContractFilter] = useState();\n  const [contracts, setContracts] = useState([]);\n  const [isInitialLoad, setIsInitialLoad] = useState(true);\n\n  const { data: contractsData } = useQuery(\"contracts\", async () => {\n    const {\n      data: { listContracts: myContracts },\n    } = await API.graphql({\n      query: listContracts,\n      variables: {\n        limit: 2000,\n      },\n    });\n    return myContracts;\n  });\n\n  const { data, isFetched, isSuccess, refetch } = useQuery(\n    \"tickets\",\n    async () => {\n      const {\n        data: {\n          ticketsByDate: { items: myTickets },\n        },\n      } = await API.graphql({\n        query: ticketsByDate,\n        variables: {\n          type: \"Ticket\",\n          sortDirection: \"DESC\",\n          limit: 500,\n        },\n      });\n      return myTickets;\n    },\n    {\n      cacheTime: 1000 * 60 * 5,\n      refetchOnReconnect: true,\n    }\n  );\n\n  useEffect(() => {\n    if (data && isFetched) {\n      setTickets(data);\n    }\n  }, [data]);\n\n  useEffect(() => {\n    if (contractsData) {\n      let options = [];\n      contractsData.items.map((c) => {\n        options.push({\n          value: c.id,\n          label: `${c.contractNumber} - ${c.contractTo.companyReportName} - ${c.contractType}`,\n        });\n      });\n      setContracts(options);\n    }\n  }, [contractsData]);\n\n  const columns = useMemo(\n    () => [\n      {\n        Header: \"Edit\",\n        accessor: \"id\",\n        disableFilters: true,\n        Cell: ({ value }) => (\n          <Link href=\"/tickets/edit/[id]\" as={`/tickets/edit/${value}`}>\n            <a className=\"text-blue-800 underline hover:text-blue-800 hover:no-underline pl-2\">\n              {\" \"}\n              Edit\n            </a>\n          </Link>\n        ),\n      },\n      {\n        Header: \"Ticket #\",\n        accessor: \"ticketNumber\",\n      },\n      {\n        Header: \"Contract #\",\n        accessor: \"contract.contractNumber\",\n        Cell: ({ row, value }) => (\n          <Link\n            href=\"/contracts/view/[id]\"\n            as={`/contracts/view/${row.original.contractId}`}\n          >\n            <a className=\"text-blue-800 underline hover:text-blue-600 hover:no-underline \">\n              {value}\n            </a>\n          </Link>\n        ),\n      },\n      {\n        Header: \"Company Name\",\n        accessor: \"contract.contractTo.companyReportName\",\n      },\n      {\n        Header: \"Ticket Date\",\n        accessor: \"ticketDate\",\n        Cell: ({ value }) => <span>{moment(value).format(\"MM/DD/YY\")}</span>,\n      },\n      {\n        Header: \"Corresponding Contract\",\n        accessor: \"corresondingContract.contractNumber\",\n        Cell: ({ row, value }) => (\n          <Link\n            href=\"/contracts/view/[id]\"\n            as={`/contracts/view/${row.original.correspondingContractId}`}\n          >\n            <a className=\"text-blue-800 underline hover:text-blue-600 hover:no-underline \">\n              {value}\n            </a>\n          </Link>\n        ),\n      },\n      {\n        Header: \"Driver\",\n        accessor: \"driver\",\n        disableFilters: true,\n      },\n      {\n        Header: \"Field #\",\n        accessor: \"fieldNum\",\n        disableFilters: true,\n      },\n      {\n        Header: \"BaleCt\",\n        accessor: \"baleCount\",\n        disableFilters: true,\n      },\n      {\n        Header: \"Gross W\",\n        accessor: \"grossWeight\",\n        disableFilters: true,\n      },\n      {\n        Header: \"Tare W\",\n        accessor: \"tareWeight\",\n        disableFilters: true,\n      },\n      {\n        Header: \"Net W\",\n        accessor: \"netWeight\",\n        disableFilters: true,\n      },\n      {\n        Header: \"Net Tons\",\n        accessor: \"netTons\",\n        disableFilters: true,\n        Footer: ({ rows }) => {\n          const total = useMemo(\n            () => rows.reduce((sum, row) => row.values.netTons + sum, 0),\n            [rows]\n          );\n          return (\n            <div className=\"py-2 text-center flex justify-around items-center border-t-4 border-gray-900\">\n              <div>\n                <span className=\"text-gray-600\">Total:</span>{\" \"}\n              </div>\n              <div>\n                <span className=\"text-lg font-bold\">{total.toFixed(2)}</span>\n              </div>\n            </div>\n          );\n        },\n      },\n      {\n        Header: \"Paid\",\n        accessor: \"paymentId\",\n        Cell: ({ row, value }) =>\n          value ? (\n            <Link\n              href=\"/payments/edit/[id]\"\n              as={`/payments/edit/${row.original.paymentId}`}\n            >\n              <a className=\"text-blue-800 underline hover:text-blue-600 hover:no-underline \">\n                View\n              </a>\n            </Link>\n          ) : null,\n      },\n    ],\n    []\n  );\n\n  return (\n    <Layout>\n      <div className=\"px-6\">\n        <div className=\"text-center w-1/2 mx-auto py-6 text-2xl font-bold\">\n          <h3>Tickets</h3>\n        </div>\n        <div className=\"\">\n          <div className=\"my-6 flex justify-between items-center\">\n            <div>\n              <Link href=\"/tickets/create\">\n                <a className=\"px-3 py-2 border border-gray-800 shadow hover:bg-gray-800 hover:text-white\">\n                  Create New\n                </a>\n              </Link>\n            </div>\n            <div>\n              <Link href=\"/tickets/all\">\n                <a className=\"px-3 py-2 border border-gray-800 shadow hover:bg-gray-800 hover:text-white\">\n                  Get All Tickets\n                </a>\n              </Link>\n            </div>\n          </div>\n        </div>\n        <div>\n          {isFetched ? (\n            <Table data={tickets} columns={columns} />\n          ) : (\n            <p className=\"text-2xl text-gray-900\">\n              Loading... This could take a couple minutes while all the tickets\n              are fetched.\n            </p>\n          )}\n        </div>\n      </div>\n      <ReactQueryDevtools />\n    </Layout>\n  );\n};\n\nexport async function getServerSideProps({ req, res }) {\n  try {\n    const { Auth } = withSSRContext({ req });\n    const user = await Auth.currentAuthenticatedUser();\n\n    return {\n      props: {\n        authenticated: true,\n        username: user.username,\n      },\n    };\n  } catch (err) {\n    res.writeHead(302, { Location: \"/sign-in\" });\n    res.end();\n    return {\n      props: {},\n    };\n  }\n}\n\nexport default AllTickets;\n"]},"metadata":{},"sourceType":"module"}