{"ast":null,"code":"var _jsxFileName = \"/Users/gregleeper/jds/pages/reports/commodity-ton-totals.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { API, withSSRContext } from \"aws-amplify\";\nimport ReactToPrint from \"react-to-print\";\nimport Table from \"../../components/table\";\nimport { useEffect, useState, useMemo, useRef } from \"react\";\nimport DatePicker from \"react-datepicker\";\nimport { computeAvgNetTons, groupBy } from \"../../utils\";\nimport moment from \"moment\";\nimport Layout from \"../../components/layout\";\nimport { ticketsByDate, contractsByType } from \"../../src/graphql/customQueries\";\nimport { listCommoditys } from \"../../src/graphql/queries.ts\";\nimport { useQuery, useInfiniteQuery, useQueryCache } from \"react-query\";\nimport { ReactQueryDevtools } from \"react-query-devtools\";\n\nconst CommodityTotals = () => {\n  const cache = useQueryCache();\n  let toPrint = useRef(null);\n  const {\n    0: beginDate,\n    1: setBeginDate\n  } = useState(cache.getQueryData(\"cctDates\") ? cache.getQueryData(\"cctDates\").beginDate : null);\n  const {\n    0: endDate,\n    1: setEndDate\n  } = useState(cache.getQueryData(\"cctDates\") ? cache.getQueryData(\"cctDates\").endDate : null);\n  const {\n    0: tickets,\n    1: setTickets\n  } = useState([]);\n  const {\n    0: ticketsYTD,\n    1: setTicketsYTD\n  } = useState([]);\n  const {\n    0: commodities,\n    1: setCommodities\n  } = useState([]);\n  const {\n    0: totals,\n    1: setTotals\n  } = useState([]);\n  const {\n    0: isInitialLoad,\n    1: setIsInitialLoad\n  } = useState(true);\n  const {\n    data: commodityData\n  } = useQuery(\"commodities\", async () => {\n    const {\n      data: {\n        listCommoditys: myCommodities\n      }\n    } = await API.graphql({\n      query: listCommoditys\n    });\n    return myCommodities;\n  }); // const { data: initTicketsData, refetch, isFetched } = useQuery(\n  //   \"commodityTonTotals\",\n  //   async () => {\n  //     const {\n  //       data: { ticketsByDate: initTickets },\n  //     } = await API.graphql({\n  //       query: listReportTickets,\n  //       variables: {\n  //         limit: 2000,\n  //         filter: {\n  //           ticketDate: {\n  //             between: [\n  //               moment(beginDate).startOf(\"day\"),\n  //               moment(endDate).endOf(\"day\"),\n  //             ],\n  //           },\n  //         },\n  //       },\n  //     });\n  //     return initTickets;\n  //   },\n  //   {\n  //     enabled: false,\n  //     cacheTime: 1000 * 60 * 59,\n  //     refetchOnWindowFocus: false,\n  //     refetchOnMount: false,\n  //     refetchIntervalInBackground: false,\n  //     refetchOnReconnect: true,\n  //     forceFetchOnMount: false,\n  //     keepPreviousData: false,\n  //   }\n  // );\n  // const {\n  //   status,\n  //   data: ticketsDataInfinite,\n  //   error,\n  //   isFetching,\n  //   isFetchingMore,\n  //   isSuccess,\n  //   fetchMore,\n  //   canFetchMore,\n  // } = useInfiniteQuery(\n  //   \"commodityTonTotals\",\n  //   async (\n  //     key,\n  //     nextToken = cache.getQueryData(\"commodityTonTotals\").nextToken\n  //   ) => {\n  //     const {\n  //       data: { ticketsByDate: ticketData },\n  //     } = await API.graphql({\n  //       query: listReportTickets,\n  //       variables: {\n  //         limit: 2000,\n  //         filter: {\n  //           ticketDate: {\n  //             between: [\n  //               moment(beginDate).startOf(\"day\"),\n  //               moment(endDate).endOf(\"day\"),\n  //             ],\n  //           },\n  //         },\n  //         nextToken,\n  //       },\n  //     });\n  //     return ticketData;\n  //   },\n  //   {\n  //     enabled: false,\n  //     getFetchMore: (lastGroup, allGroups) => lastGroup.nextToken,\n  //     cacheTime: 1000 * 60 * 60,\n  //     refetchOnWindowFocus: false,\n  //     forceFetchOnMount: false,\n  //     keepPreviousData: false,\n  //   }\n  // );\n\n  const {\n    data: ytdTicketsData,\n    refetch: refetchYTD\n  } = useQuery(\"commodityTonTotalsYTD\", async () => {\n    const {\n      data: {\n        contractsByType: initTicketsYTD\n      }\n    } = await API.graphql({\n      query: contractsByType,\n      variables: {\n        limit: 20,\n        filter: {\n          contractState: {\n            eq: \"ACTIVE\"\n          }\n        },\n        ticketFilter: {\n          ticketDate: {\n            between: [moment().startOf(\"year\"), moment(endDate).endOf(\"date\")]\n          }\n        },\n        contractType: \"SALE\"\n      }\n    });\n    return initTicketsYTD;\n  }, {\n    enabled: false,\n    cacheTime: 1000 * 60 * 59,\n    refetchOnWindowFocus: false,\n    refetchOnMount: false,\n    refetchIntervalInBackground: false,\n    refetchOnReconnect: true\n  });\n  const {\n    status: ytdStatus,\n    data: ytdData,\n    error: ytdError,\n    isFetched,\n    isFetching: ytdIsFetching,\n    isFetchingMore: ytdIsFetchingMore,\n    fetchMore: ytdFetchMore,\n    canFetchMore,\n    isSuccess\n  } = useInfiniteQuery(\"commodityTonTotalsYTD\", async (key, nextToken = cache.getQueryData(\"commodityTonTotalsYTD\").nextToken) => {\n    const {\n      data: {\n        contractsByType: ticketData\n      }\n    } = await API.graphql({\n      query: contractsByType,\n      variables: {\n        limit: 20,\n        contractType: \"SALE\",\n        filter: {\n          contractState: {\n            eq: \"ACTIVE\"\n          }\n        },\n        ticketFilter: {\n          ticketDate: {\n            between: [moment().startOf(\"year\"), moment(endDate).endOf(\"day\")]\n          }\n        },\n        nextToken\n      }\n    });\n    return ticketData;\n  }, {\n    enabled: false,\n    getFetchMore: (lastGroup, allGroups) => lastGroup.nextToken,\n    cacheTime: 1000 * 60 * 60,\n    refetchOnWindowFocus: false\n  });\n\n  const computeTotals = () => {\n    const startBeginDate = moment(beginDate).startOf(\"date\");\n    const endOfEndDate = moment(endDate).endOf(\"date\");\n    const filteredByWeek = ticketsYTD.filter(ticket => moment(ticket.ticketDate).isSameOrAfter(startBeginDate) && moment(ticket.ticketDate).isSameOrBefore(endOfEndDate));\n    const groupedYTD = groupBy(ticketsYTD, ticket => ticket.contract.commodity.name);\n    const grouped = groupBy(filteredByWeek, ticket => ticket.contract.commodity.name);\n    let array = [];\n    commodities.map(c => {\n      let commodityTotal = {};\n      const group = grouped.get(c.name);\n      console.log(group);\n      const ytdGroup = groupedYTD.get(c.name);\n      commodityTotal.commodity = c.name;\n      commodityTotal.weekNumLoads = group ? group.length : 0;\n      commodityTotal.yearNumLoads = ytdGroup ? ytdGroup.length : 0;\n      commodityTotal.weekAvgTons = group ? group.reduce((acc, cv) => acc + cv.netTons, 0) / group.length : 0;\n      commodityTotal.yearAvgTons = ytdGroup ? ytdGroup.reduce((acc, cv) => acc + cv.netTons, 0) / ytdGroup.length : 0;\n      array.push(commodityTotal);\n    });\n    setTotals(array);\n  };\n\n  const computeWeekTotalAvg = () => {\n    let count = 0;\n    totals.map(t => {\n      if (t.weekAvgTons) {\n        count++;\n      }\n    });\n    console.log(totals.reduce((a, cv) => a + cv.weekAvgTons, 0));\n    return totals.reduce((a, cv) => a + cv.weekAvgTons, 0) / count;\n  };\n\n  const computeYearTotalAvg = () => {\n    let count = 0;\n    totals.map(t => {\n      if (t.yearAvgTons) {\n        count++;\n      }\n    });\n    return totals.reduce((a, cv) => a + cv.yearAvgTons, 0) / count;\n  };\n\n  useEffect(() => {\n    if (commodityData) {\n      setCommodities(commodityData.items);\n    }\n  }, [commodityData]);\n  useEffect(() => {\n    if (totals.length) {\n      totals.sort((a, b) => {\n        let nameA = a.commodity;\n        let nameB = b.commodity;\n\n        if (nameA < nameB) {\n          return -1;\n        }\n\n        if (nameA > nameB) {\n          return 1;\n        }\n\n        return 0;\n      });\n    }\n  }, [totals]);\n  useEffect(() => {\n    if (ytdTicketsData) {\n      ytdFetchMore();\n    }\n\n    if (ytdTicketsData && canFetchMore && !ytdIsFetchingMore) {\n      ytdFetchMore();\n    }\n\n    if (ytdTicketsData && ytdTicketsData.length && !canFetchMore) {\n      compileDataYTD();\n    }\n  }, [ytdTicketsData]); // useEffect(() => {\n  //   if (initTicketsData) {\n  //     fetchMore();\n  //   }\n  //   if (initTicketsData && canFetchMore && !isFetchingMore) {\n  //     fetchMore();\n  //   }\n  //   if (initTicketsData && initTicketsData.length && !canFetchMore) {\n  //     compileData();\n  //   }\n  // }, [initTicketsData]);\n\n  useEffect(() => {\n    if (ticketsYTD.length > 0) {\n      computeTotals();\n      cache.setQueryData(\"cctDates\", {\n        beginDate: beginDate,\n        endDate: endDate\n      });\n    }\n  }, [ticketsYTD]);\n\n  const handleFetchQueries = () => {\n    setTickets([]);\n    setTicketsYTD([]);\n    setTotals([]);\n    refetchYTD();\n  }; // const compileData = () => {\n  //   if (isInitialLoad) {\n  //     let array = [...tickets];\n  //     ticketsDataInfinite &&\n  //       ticketsDataInfinite.map((group, i) => {\n  //         group.items.map((item) => array.push(item));\n  //       });\n  //     setTickets(array);\n  //     setIsInitialLoad(false);\n  //   } else {\n  //     let array = [];\n  //     ticketsDataInfinite &&\n  //       ticketsDataInfinite.map((group, i) => {\n  //         group.items.map((item) => array.push(item));\n  //       });\n  //     setTickets(array);\n  //   }\n  // };\n\n\n  const compileDataYTD = () => {\n    if (isInitialLoad) {\n      let array = [...ticketsYTD];\n      ytdData && ytdData.map((group, i) => {\n        group.items.map(item => {\n          item.tickets.items.length ? array.push(item.tickets.items) : null;\n        });\n      });\n      setTicketsYTD(array.flat());\n      setIsInitialLoad(false);\n    } else {\n      let array = [];\n      ytdData && ytdData.map((group, i) => {\n        group.items.map(item => {\n          item.tickets.items.length ? array.push(item.tickets.items) : null;\n        });\n      });\n      setTicketsYTD(array.flat());\n    }\n  };\n\n  console.log(ticketsYTD);\n  const columns = useMemo(() => [{\n    Header: \"Commodity\",\n    accessor: \"commodity\"\n  }, {\n    Header: \"Weekly Number of Loads\",\n    accessor: \"weekNumLoads\"\n  }, {\n    Header: \"Year Number of Loads\",\n    accessor: \"yearNumLoads\"\n  }, {\n    Header: \"Week Avg Tons\",\n    accessor: \"weekAvgTons\"\n  }, {\n    Header: \"YTD Avg Tons\",\n    accessor: \"yearAvgTons\"\n  }], []);\n  return __jsx(Layout, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 404,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: \"px-12\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"text-center w-1/2 mx-auto py-6 text-2xl font-bold\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 406,\n      columnNumber: 9\n    }\n  }, __jsx(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 11\n    }\n  }, \"Commodity Ton Totals\")), __jsx(ReactToPrint, {\n    trigger: () => __jsx(\"a\", {\n      href: \"#\",\n      className: \"px-3 py-2 border border-gray-800 shadow hover:bg-gray-800 hover:text-white\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 411,\n        columnNumber: 13\n      }\n    }, \"Print Report\"),\n    content: () => toPrint,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 409,\n      columnNumber: 9\n    }\n  }), __jsx(\"div\", {\n    className: \"w-7/12 mx-auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 420,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"flex justify-between items-end w-1/2 mx-auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 421,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 422,\n      columnNumber: 13\n    }\n  }, __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 423,\n      columnNumber: 15\n    }\n  }, \"Begin Date\"), __jsx(DatePicker, {\n    selected: beginDate,\n    onChange: date => setBeginDate(date),\n    className: \"form-input w-full\",\n    startDate: beginDate,\n    selectsStart: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 424,\n      columnNumber: 15\n    }\n  })), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 432,\n      columnNumber: 13\n    }\n  }, __jsx(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 433,\n      columnNumber: 15\n    }\n  }, \"End Date\"), __jsx(DatePicker, {\n    selected: endDate,\n    onChange: date => setEndDate(date),\n    className: \"form-input w-full\",\n    endDate: endDate,\n    minDate: beginDate,\n    selectsStart: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 434,\n      columnNumber: 15\n    }\n  })), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 443,\n      columnNumber: 13\n    }\n  }, __jsx(\"button\", {\n    className: \"px-3 py-2 border border-gray-800 shadow hover:bg-gray-800 hover:text-white\",\n    onClick: () => handleFetchQueries(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 444,\n      columnNumber: 15\n    }\n  }, \"Submit\"))), __jsx(\"div\", {\n    className: \"pt-6 mx-12\",\n    ref: el => toPrint = el,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 453,\n      columnNumber: 11\n    }\n  }, __jsx(\"h6\", {\n    className: \"font-semibold text-xl text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 454,\n      columnNumber: 13\n    }\n  }, \"Commodity Ton Totals\"), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 457,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 458,\n      columnNumber: 15\n    }\n  }, __jsx(\"span\", {\n    className: \"text-gray-600 text-sm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 459,\n      columnNumber: 17\n    }\n  }, \"Beginning Date: \"), __jsx(\"span\", {\n    className: \"mx-1 text-base text-gray-900\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 460,\n      columnNumber: 17\n    }\n  }, moment(beginDate).isValid() ? moment(beginDate).format(\"MM/DD/YY\") : `Not Set`)), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 466,\n      columnNumber: 15\n    }\n  }, __jsx(\"span\", {\n    className: \"text-gray-600 text-sm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 467,\n      columnNumber: 17\n    }\n  }, \"End Date: \"), __jsx(\"span\", {\n    className: \"mx-1 text-base text-gray-900 \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 468,\n      columnNumber: 17\n    }\n  }, \" \", moment(beginDate).isValid() ? moment(endDate).format(\"MM/DD/YY\") : `Not Set`))), __jsx(\"div\", {\n    className: \"pb-24 pt-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 476,\n      columnNumber: 13\n    }\n  }, !isFetched ? __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 478,\n      columnNumber: 17\n    }\n  }, \"Choose dates to generate report.\") : isSuccess && !canFetchMore ? __jsx(\"table\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 480,\n      columnNumber: 17\n    }\n  }, __jsx(\"thead\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 481,\n      columnNumber: 19\n    }\n  }, __jsx(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 482,\n      columnNumber: 21\n    }\n  }, __jsx(\"th\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 483,\n      columnNumber: 23\n    }\n  }, \"Commodity\"), __jsx(\"th\", {\n    className: \"pr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 484,\n      columnNumber: 23\n    }\n  }, \"Week Number Loads\"), __jsx(\"th\", {\n    className: \"pr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 485,\n      columnNumber: 23\n    }\n  }, \"Year Number Loads\"), __jsx(\"th\", {\n    className: \"pr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 486,\n      columnNumber: 23\n    }\n  }, \"Week Avg Tons\"), __jsx(\"th\", {\n    className: \"pr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 487,\n      columnNumber: 23\n    }\n  }, \" Year Avg Tons\"))), __jsx(\"tbody\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 490,\n      columnNumber: 19\n    }\n  }, totals.map(total => __jsx(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 492,\n      columnNumber: 23\n    }\n  }, __jsx(\"td\", {\n    className: \"px-2 py-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 493,\n      columnNumber: 25\n    }\n  }, total.commodity), __jsx(\"td\", {\n    className: \"px-2 py-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 494,\n      columnNumber: 25\n    }\n  }, \" \", total.weekNumLoads), __jsx(\"td\", {\n    className: \"px-2 py-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 495,\n      columnNumber: 25\n    }\n  }, total.yearNumLoads), __jsx(\"td\", {\n    className: \"px-2 py-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 496,\n      columnNumber: 25\n    }\n  }, total.weekAvgTons.toFixed(2)), __jsx(\"td\", {\n    className: \"px-2 py-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 499,\n      columnNumber: 25\n    }\n  }, total.yearAvgTons.toFixed(2)))), __jsx(\"tr\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 504,\n      columnNumber: 21\n    }\n  }, __jsx(\"td\", {\n    className: \"border-t-4 border-gray-600\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 505,\n      columnNumber: 23\n    }\n  }, \"Totals:\"), __jsx(\"td\", {\n    className: \"border-t-4 border-gray-600\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 506,\n      columnNumber: 23\n    }\n  }, console.log(totals), totals.reduce((accumulator, cv) => accumulator + cv.weekNumLoads, 0)), __jsx(\"td\", {\n    className: \"border-t-4 border-gray-600\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 514,\n      columnNumber: 23\n    }\n  }, totals.reduce((accumulator, cv) => accumulator + cv.yearNumLoads, 0)), __jsx(\"td\", {\n    className: \"border-t-4 border-gray-600\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 520,\n      columnNumber: 23\n    }\n  }, totals.length && computeWeekTotalAvg().toFixed(2)), __jsx(\"td\", {\n    className: \"border-t-4 border-gray-600\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 523,\n      columnNumber: 23\n    }\n  }, totals.length && computeYearTotalAvg().toFixed(2)))), __jsx(\"tbody\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 528,\n      columnNumber: 19\n    }\n  })) : __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 531,\n      columnNumber: 17\n    }\n  }, \"Loading...\"))), __jsx(ReactQueryDevtools, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 535,\n      columnNumber: 11\n    }\n  }))));\n};\n\nexport async function getServerSideProps({\n  req,\n  res\n}) {\n  const {\n    Auth\n  } = withSSRContext({\n    req\n  });\n\n  try {\n    const user = await Auth.currentAuthenticatedUser();\n    return {\n      props: {\n        authenticated: true,\n        username: user.username\n      }\n    };\n  } catch (err) {\n    res.writeHead(302, {\n      Location: \"/sign-in\"\n    });\n    res.end();\n    return {\n      props: {\n        authenticated: false\n      }\n    };\n  }\n}\nexport default CommodityTotals;","map":{"version":3,"sources":["/Users/gregleeper/jds/pages/reports/commodity-ton-totals.js"],"names":["API","withSSRContext","ReactToPrint","Table","useEffect","useState","useMemo","useRef","DatePicker","computeAvgNetTons","groupBy","moment","Layout","ticketsByDate","contractsByType","listCommoditys","useQuery","useInfiniteQuery","useQueryCache","ReactQueryDevtools","CommodityTotals","cache","toPrint","beginDate","setBeginDate","getQueryData","endDate","setEndDate","tickets","setTickets","ticketsYTD","setTicketsYTD","commodities","setCommodities","totals","setTotals","isInitialLoad","setIsInitialLoad","data","commodityData","myCommodities","graphql","query","ytdTicketsData","refetch","refetchYTD","initTicketsYTD","variables","limit","filter","contractState","eq","ticketFilter","ticketDate","between","startOf","endOf","contractType","enabled","cacheTime","refetchOnWindowFocus","refetchOnMount","refetchIntervalInBackground","refetchOnReconnect","status","ytdStatus","ytdData","error","ytdError","isFetched","isFetching","ytdIsFetching","isFetchingMore","ytdIsFetchingMore","fetchMore","ytdFetchMore","canFetchMore","isSuccess","key","nextToken","ticketData","getFetchMore","lastGroup","allGroups","computeTotals","startBeginDate","endOfEndDate","filteredByWeek","ticket","isSameOrAfter","isSameOrBefore","groupedYTD","contract","commodity","name","grouped","array","map","c","commodityTotal","group","get","console","log","ytdGroup","weekNumLoads","length","yearNumLoads","weekAvgTons","reduce","acc","cv","netTons","yearAvgTons","push","computeWeekTotalAvg","count","t","a","computeYearTotalAvg","items","sort","b","nameA","nameB","compileDataYTD","setQueryData","handleFetchQueries","i","item","flat","columns","Header","accessor","date","el","isValid","format","total","toFixed","accumulator","getServerSideProps","req","res","Auth","user","currentAuthenticatedUser","props","authenticated","username","err","writeHead","Location","end"],"mappings":"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","sourcesContent":["import { API, withSSRContext } from \"aws-amplify\";\nimport ReactToPrint from \"react-to-print\";\nimport Table from \"../../components/table\";\nimport { useEffect, useState, useMemo, useRef } from \"react\";\nimport DatePicker from \"react-datepicker\";\nimport { computeAvgNetTons, groupBy } from \"../../utils\";\nimport moment from \"moment\";\nimport Layout from \"../../components/layout\";\nimport {\n  ticketsByDate,\n  contractsByType,\n} from \"../../src/graphql/customQueries\";\nimport { listCommoditys } from \"../../src/graphql/queries.ts\";\nimport { useQuery, useInfiniteQuery, useQueryCache } from \"react-query\";\nimport { ReactQueryDevtools } from \"react-query-devtools\";\n\nconst CommodityTotals = () => {\n  const cache = useQueryCache();\n  let toPrint = useRef(null);\n  const [beginDate, setBeginDate] = useState(\n    cache.getQueryData(\"cctDates\")\n      ? cache.getQueryData(\"cctDates\").beginDate\n      : null\n  );\n  const [endDate, setEndDate] = useState(\n    cache.getQueryData(\"cctDates\")\n      ? cache.getQueryData(\"cctDates\").endDate\n      : null\n  );\n  const [tickets, setTickets] = useState([]);\n  const [ticketsYTD, setTicketsYTD] = useState([]);\n  const [commodities, setCommodities] = useState([]);\n  const [totals, setTotals] = useState([]);\n  const [isInitialLoad, setIsInitialLoad] = useState(true);\n\n  const { data: commodityData } = useQuery(\"commodities\", async () => {\n    const {\n      data: { listCommoditys: myCommodities },\n    } = await API.graphql({\n      query: listCommoditys,\n    });\n    return myCommodities;\n  });\n\n  // const { data: initTicketsData, refetch, isFetched } = useQuery(\n  //   \"commodityTonTotals\",\n  //   async () => {\n  //     const {\n  //       data: { ticketsByDate: initTickets },\n  //     } = await API.graphql({\n  //       query: listReportTickets,\n  //       variables: {\n  //         limit: 2000,\n  //         filter: {\n  //           ticketDate: {\n  //             between: [\n  //               moment(beginDate).startOf(\"day\"),\n  //               moment(endDate).endOf(\"day\"),\n  //             ],\n  //           },\n  //         },\n  //       },\n  //     });\n  //     return initTickets;\n  //   },\n  //   {\n  //     enabled: false,\n  //     cacheTime: 1000 * 60 * 59,\n  //     refetchOnWindowFocus: false,\n  //     refetchOnMount: false,\n  //     refetchIntervalInBackground: false,\n  //     refetchOnReconnect: true,\n  //     forceFetchOnMount: false,\n  //     keepPreviousData: false,\n  //   }\n  // );\n\n  // const {\n  //   status,\n  //   data: ticketsDataInfinite,\n  //   error,\n  //   isFetching,\n  //   isFetchingMore,\n  //   isSuccess,\n  //   fetchMore,\n  //   canFetchMore,\n  // } = useInfiniteQuery(\n  //   \"commodityTonTotals\",\n  //   async (\n  //     key,\n  //     nextToken = cache.getQueryData(\"commodityTonTotals\").nextToken\n  //   ) => {\n  //     const {\n  //       data: { ticketsByDate: ticketData },\n  //     } = await API.graphql({\n  //       query: listReportTickets,\n  //       variables: {\n  //         limit: 2000,\n  //         filter: {\n  //           ticketDate: {\n  //             between: [\n  //               moment(beginDate).startOf(\"day\"),\n  //               moment(endDate).endOf(\"day\"),\n  //             ],\n  //           },\n  //         },\n  //         nextToken,\n  //       },\n  //     });\n  //     return ticketData;\n  //   },\n  //   {\n  //     enabled: false,\n  //     getFetchMore: (lastGroup, allGroups) => lastGroup.nextToken,\n  //     cacheTime: 1000 * 60 * 60,\n  //     refetchOnWindowFocus: false,\n  //     forceFetchOnMount: false,\n  //     keepPreviousData: false,\n  //   }\n  // );\n\n  const { data: ytdTicketsData, refetch: refetchYTD } = useQuery(\n    \"commodityTonTotalsYTD\",\n    async () => {\n      const {\n        data: { contractsByType: initTicketsYTD },\n      } = await API.graphql({\n        query: contractsByType,\n        variables: {\n          limit: 20,\n          filter: {\n            contractState: { eq: \"ACTIVE\" },\n          },\n          ticketFilter: {\n            ticketDate: {\n              between: [\n                moment().startOf(\"year\"),\n                moment(endDate).endOf(\"date\"),\n              ],\n            },\n          },\n          contractType: \"SALE\",\n        },\n      });\n\n      return initTicketsYTD;\n    },\n    {\n      enabled: false,\n      cacheTime: 1000 * 60 * 59,\n      refetchOnWindowFocus: false,\n      refetchOnMount: false,\n      refetchIntervalInBackground: false,\n      refetchOnReconnect: true,\n    }\n  );\n\n  const {\n    status: ytdStatus,\n    data: ytdData,\n    error: ytdError,\n    isFetched,\n    isFetching: ytdIsFetching,\n    isFetchingMore: ytdIsFetchingMore,\n    fetchMore: ytdFetchMore,\n    canFetchMore,\n    isSuccess,\n  } = useInfiniteQuery(\n    \"commodityTonTotalsYTD\",\n    async (\n      key,\n      nextToken = cache.getQueryData(\"commodityTonTotalsYTD\").nextToken\n    ) => {\n      const {\n        data: { contractsByType: ticketData },\n      } = await API.graphql({\n        query: contractsByType,\n        variables: {\n          limit: 20,\n          contractType: \"SALE\",\n          filter: {\n            contractState: { eq: \"ACTIVE\" },\n          },\n          ticketFilter: {\n            ticketDate: {\n              between: [moment().startOf(\"year\"), moment(endDate).endOf(\"day\")],\n            },\n          },\n\n          nextToken,\n        },\n      });\n      return ticketData;\n    },\n    {\n      enabled: false,\n      getFetchMore: (lastGroup, allGroups) => lastGroup.nextToken,\n      cacheTime: 1000 * 60 * 60,\n      refetchOnWindowFocus: false,\n    }\n  );\n\n  const computeTotals = () => {\n    const startBeginDate = moment(beginDate).startOf(\"date\");\n    const endOfEndDate = moment(endDate).endOf(\"date\");\n\n    const filteredByWeek = ticketsYTD.filter(\n      (ticket) =>\n        moment(ticket.ticketDate).isSameOrAfter(startBeginDate) &&\n        moment(ticket.ticketDate).isSameOrBefore(endOfEndDate)\n    );\n\n    const groupedYTD = groupBy(\n      ticketsYTD,\n      (ticket) => ticket.contract.commodity.name\n    );\n    const grouped = groupBy(\n      filteredByWeek,\n      (ticket) => ticket.contract.commodity.name\n    );\n    let array = [];\n    commodities.map((c) => {\n      let commodityTotal = {};\n      const group = grouped.get(c.name);\n      console.log(group);\n      const ytdGroup = groupedYTD.get(c.name);\n      commodityTotal.commodity = c.name;\n\n      commodityTotal.weekNumLoads = group ? group.length : 0;\n      commodityTotal.yearNumLoads = ytdGroup ? ytdGroup.length : 0;\n\n      commodityTotal.weekAvgTons = group\n        ? group.reduce((acc, cv) => acc + cv.netTons, 0) / group.length\n        : 0;\n      commodityTotal.yearAvgTons = ytdGroup\n        ? ytdGroup.reduce((acc, cv) => acc + cv.netTons, 0) / ytdGroup.length\n        : 0;\n\n      array.push(commodityTotal);\n    });\n\n    setTotals(array);\n  };\n\n  const computeWeekTotalAvg = () => {\n    let count = 0;\n    totals.map((t) => {\n      if (t.weekAvgTons) {\n        count++;\n      }\n    });\n    console.log(totals.reduce((a, cv) => a + cv.weekAvgTons, 0));\n    return totals.reduce((a, cv) => a + cv.weekAvgTons, 0) / count;\n  };\n\n  const computeYearTotalAvg = () => {\n    let count = 0;\n    totals.map((t) => {\n      if (t.yearAvgTons) {\n        count++;\n      }\n    });\n    return totals.reduce((a, cv) => a + cv.yearAvgTons, 0) / count;\n  };\n\n  useEffect(() => {\n    if (commodityData) {\n      setCommodities(commodityData.items);\n    }\n  }, [commodityData]);\n\n  useEffect(() => {\n    if (totals.length) {\n      totals.sort((a, b) => {\n        let nameA = a.commodity;\n        let nameB = b.commodity;\n        if (nameA < nameB) {\n          return -1;\n        }\n        if (nameA > nameB) {\n          return 1;\n        }\n        return 0;\n      });\n    }\n  }, [totals]);\n\n  useEffect(() => {\n    if (ytdTicketsData) {\n      ytdFetchMore();\n    }\n    if (ytdTicketsData && canFetchMore && !ytdIsFetchingMore) {\n      ytdFetchMore();\n    }\n    if (ytdTicketsData && ytdTicketsData.length && !canFetchMore) {\n      compileDataYTD();\n    }\n  }, [ytdTicketsData]);\n\n  // useEffect(() => {\n  //   if (initTicketsData) {\n  //     fetchMore();\n  //   }\n  //   if (initTicketsData && canFetchMore && !isFetchingMore) {\n  //     fetchMore();\n  //   }\n\n  //   if (initTicketsData && initTicketsData.length && !canFetchMore) {\n  //     compileData();\n  //   }\n  // }, [initTicketsData]);\n\n  useEffect(() => {\n    if (ticketsYTD.length > 0) {\n      computeTotals();\n      cache.setQueryData(\"cctDates\", {\n        beginDate: beginDate,\n        endDate: endDate,\n      });\n    }\n  }, [ticketsYTD]);\n\n  const handleFetchQueries = () => {\n    setTickets([]);\n    setTicketsYTD([]);\n    setTotals([]);\n\n    refetchYTD();\n  };\n\n  // const compileData = () => {\n  //   if (isInitialLoad) {\n  //     let array = [...tickets];\n\n  //     ticketsDataInfinite &&\n  //       ticketsDataInfinite.map((group, i) => {\n  //         group.items.map((item) => array.push(item));\n  //       });\n  //     setTickets(array);\n  //     setIsInitialLoad(false);\n  //   } else {\n  //     let array = [];\n  //     ticketsDataInfinite &&\n  //       ticketsDataInfinite.map((group, i) => {\n  //         group.items.map((item) => array.push(item));\n  //       });\n  //     setTickets(array);\n  //   }\n  // };\n\n  const compileDataYTD = () => {\n    if (isInitialLoad) {\n      let array = [...ticketsYTD];\n\n      ytdData &&\n        ytdData.map((group, i) => {\n          group.items.map((item) => {\n            item.tickets.items.length ? array.push(item.tickets.items) : null;\n          });\n        });\n\n      setTicketsYTD(array.flat());\n\n      setIsInitialLoad(false);\n    } else {\n      let array = [];\n      ytdData &&\n        ytdData.map((group, i) => {\n          group.items.map((item) => {\n            item.tickets.items.length ? array.push(item.tickets.items) : null;\n          });\n        });\n      setTicketsYTD(array.flat());\n    }\n  };\n  console.log(ticketsYTD);\n  const columns = useMemo(\n    () => [\n      {\n        Header: \"Commodity\",\n        accessor: \"commodity\",\n      },\n      {\n        Header: \"Weekly Number of Loads\",\n        accessor: \"weekNumLoads\",\n      },\n      {\n        Header: \"Year Number of Loads\",\n        accessor: \"yearNumLoads\",\n      },\n      {\n        Header: \"Week Avg Tons\",\n        accessor: \"weekAvgTons\",\n      },\n      {\n        Header: \"YTD Avg Tons\",\n        accessor: \"yearAvgTons\",\n      },\n    ],\n    []\n  );\n\n  return (\n    <Layout>\n      <div className=\"px-12\">\n        <div className=\"text-center w-1/2 mx-auto py-6 text-2xl font-bold\">\n          <h3>Commodity Ton Totals</h3>\n        </div>\n        <ReactToPrint\n          trigger={() => (\n            <a\n              href=\"#\"\n              className=\"px-3 py-2 border border-gray-800 shadow hover:bg-gray-800 hover:text-white\"\n            >\n              Print Report\n            </a>\n          )}\n          content={() => toPrint}\n        />\n        <div className=\"w-7/12 mx-auto\">\n          <div className=\"flex justify-between items-end w-1/2 mx-auto\">\n            <div>\n              <span>Begin Date</span>\n              <DatePicker\n                selected={beginDate}\n                onChange={(date) => setBeginDate(date)}\n                className=\"form-input w-full\"\n                startDate={beginDate}\n                selectsStart\n              />\n            </div>\n            <div>\n              <span>End Date</span>\n              <DatePicker\n                selected={endDate}\n                onChange={(date) => setEndDate(date)}\n                className=\"form-input w-full\"\n                endDate={endDate}\n                minDate={beginDate}\n                selectsStart\n              />\n            </div>\n            <div>\n              <button\n                className=\"px-3 py-2 border border-gray-800 shadow hover:bg-gray-800 hover:text-white\"\n                onClick={() => handleFetchQueries()}\n              >\n                Submit\n              </button>\n            </div>\n          </div>\n\n          <div className=\"pt-6 mx-12\" ref={(el) => (toPrint = el)}>\n            <h6 className=\"font-semibold text-xl text-center\">\n              Commodity Ton Totals\n            </h6>\n            <div>\n              <div>\n                <span className=\"text-gray-600 text-sm\">Beginning Date: </span>\n                <span className=\"mx-1 text-base text-gray-900\">\n                  {moment(beginDate).isValid()\n                    ? moment(beginDate).format(\"MM/DD/YY\")\n                    : `Not Set`}\n                </span>\n              </div>\n              <div>\n                <span className=\"text-gray-600 text-sm\">End Date: </span>\n                <span className=\"mx-1 text-base text-gray-900 \">\n                  {\" \"}\n                  {moment(beginDate).isValid()\n                    ? moment(endDate).format(\"MM/DD/YY\")\n                    : `Not Set`}\n                </span>\n              </div>\n            </div>\n            <div className=\"pb-24 pt-6\">\n              {!isFetched ? (\n                <p>Choose dates to generate report.</p>\n              ) : isSuccess && !canFetchMore ? (\n                <table>\n                  <thead>\n                    <tr>\n                      <th>Commodity</th>\n                      <th className=\"pr-2\">Week Number Loads</th>\n                      <th className=\"pr-2\">Year Number Loads</th>\n                      <th className=\"pr-2\">Week Avg Tons</th>\n                      <th className=\"pr-2\"> Year Avg Tons</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {totals.map((total) => (\n                      <tr>\n                        <td className=\"px-2 py-1\">{total.commodity}</td>\n                        <td className=\"px-2 py-1\"> {total.weekNumLoads}</td>\n                        <td className=\"px-2 py-1\">{total.yearNumLoads}</td>\n                        <td className=\"px-2 py-1\">\n                          {total.weekAvgTons.toFixed(2)}\n                        </td>\n                        <td className=\"px-2 py-1\">\n                          {total.yearAvgTons.toFixed(2)}\n                        </td>\n                      </tr>\n                    ))}\n                    <tr>\n                      <td className=\"border-t-4 border-gray-600\">Totals:</td>\n                      <td className=\"border-t-4 border-gray-600\">\n                        {console.log(totals)}\n\n                        {totals.reduce(\n                          (accumulator, cv) => accumulator + cv.weekNumLoads,\n                          0\n                        )}\n                      </td>\n                      <td className=\"border-t-4 border-gray-600\">\n                        {totals.reduce(\n                          (accumulator, cv) => accumulator + cv.yearNumLoads,\n                          0\n                        )}\n                      </td>\n                      <td className=\"border-t-4 border-gray-600\">\n                        {totals.length && computeWeekTotalAvg().toFixed(2)}\n                      </td>\n                      <td className=\"border-t-4 border-gray-600\">\n                        {totals.length && computeYearTotalAvg().toFixed(2)}\n                      </td>\n                    </tr>\n                  </tbody>\n                  <tbody></tbody>\n                </table>\n              ) : (\n                <p>Loading...</p>\n              )}\n            </div>\n          </div>\n          <ReactQueryDevtools />\n        </div>\n      </div>\n    </Layout>\n  );\n};\n\nexport async function getServerSideProps({ req, res }) {\n  const { Auth } = withSSRContext({ req });\n  try {\n    const user = await Auth.currentAuthenticatedUser();\n\n    return {\n      props: {\n        authenticated: true,\n        username: user.username,\n      },\n    };\n  } catch (err) {\n    res.writeHead(302, { Location: \"/sign-in\" });\n    res.end();\n    return {\n      props: {\n        authenticated: false,\n      },\n    };\n  }\n}\n\nexport default CommodityTotals;\n"]},"metadata":{},"sourceType":"module"}